<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Provide functions to efficiently import SRE data • dipr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Provide functions to efficiently import SRE data">
<meta property="og:description" content="Provides functions that aid in working with SRE data. Caching
    is provided through several means and enables more efficient reading
    of data into memory. Functions are also provided to convert to Apache
    Arrow formats.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">dipr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bcgov/dipr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="dipr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#dipr" class="anchor"></a>dipr</h1></div>
<p>The <code>dipr</code> package is an R package that loads and provides means of caching of <code>.dat.gz</code> files. Functions are also provided to convert from <code>.dat.gz</code> files to Apache Arrow formats.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>While this package is intended for us within the SRE you can install the package from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"bcgov/dipr"</span><span class="op">)</span></code></pre></div>
</div>
<div id="installation-inside-the-sre" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-inside-the-sre" class="anchor"></a>Installation inside the SRE</h2>
<p>Installation of <code>dipr</code> is slightly different than typical R package installation. To begin with you will need to clone the dipr repo. To do this you need access to the SRE instance of GitLab.</p>
<p>Go to this website: <a href="https://projectsc.popdata.bc.ca/" class="uri">https://projectsc.popdata.bc.ca/</a></p>
<p>Scroll down and click on “Sign in with Pop Data Sso”</p>
<p>You will need to do this step everytime you log into the SRE.</p>
<p>Next go to this site: <a href="https://projectsc.popdata.bc.ca/profile/personal_access_tokens" class="uri">https://projectsc.popdata.bc.ca/profile/personal_access_tokens</a></p>
<p>Create a new Personal Access Token enabling each scope and typing in your username. This should create a new personal access token. Those are your “git credentials”. Save those on your “U” drive along with your user name.</p>
<div id="clone-from-rstudio" class="section level3">
<h3 class="hasAnchor">
<a href="#clone-from-rstudio" class="anchor"></a>Clone from RStudio</h3>
<p>Open RStudio and go to File -&gt; New Project -&gt; Version Control -&gt; Git</p>
<p>In the field <code>Repository URL</code> section type: <a href="https://projectsc.popdata.bc.ca/shares/dipr" class="uri">https://projectsc.popdata.bc.ca/shares/dipr</a></p>
<p>In the field <code>Create project as subdirectory of</code> browse to where you want to clone this repo. I’d recommend putting this in a personal but open to other team members folder.</p>
</div>
<div id="clone-from-bash" class="section level3">
<h3 class="hasAnchor">
<a href="#clone-from-bash" class="anchor"></a>Clone from bash</h3>
<p>Navigate to where you would like to clone the repo.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>git clone https<span class="op">:</span><span class="er">//</span>projectsc.popdata.bc.ca<span class="op">/</span>shares<span class="op">/</span>dipr</span></code></pre></div>
</div>
<div id="installation-using-devtools" class="section level3">
<h3 class="hasAnchor">
<a href="#installation-using-devtools" class="anchor"></a>Installation using devtools</h3>
<p>This will clone the repo and you can install from there. Inside the repo will be an <code>dipr.Rproj</code>. Double clicking on that will open RStudio. Next run the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/install.html">install</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Once you have the package installed you can use <code><a href="reference/dipr_update.html">dipr::dipr_update</a></code> to update.</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The <code>dipr</code> package comes with some sample <em>fake</em> data to illustrate the usage of the package and facilitate unit tests. Specifically, the package provides a fake data dictionary and a compressed data file. Example fake data can be seen like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bcgov/dipr">dipr</a></span><span class="op">)</span>
<span class="fu"><a href="reference/dipr_examples.html">dipr_examples</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "starwars-dict.nflt"   "starwars-dict.txt"    "starwars-fwf.dat"    </span>
<span class="co">#&gt; [4] "starwars-fwf.dat.gz"  "starwars-fwf2.dat"    "starwars-fwf2.dat.gz"</span></code></pre></div>
<p>Individual paths can be extracted like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_dict_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dipr_examples.html">dipr_example</a></span><span class="op">(</span><span class="st">"starwars-dict.txt"</span><span class="op">)</span>
<span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">data_dict_path</span><span class="op">)</span>
<span class="va">dict</span>
<span class="co">#&gt;       name start stop col_type</span>
<span class="co">#&gt; 1     name     1   21        c</span>
<span class="co">#&gt; 2   height    22   24        i</span>
<span class="co">#&gt; 3     mass    25   30        d</span>
<span class="co">#&gt; 4 has_hair    31   35        l</span>
<span class="co">#&gt; 5  species    36   50        c</span>
<span class="va">dat_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dipr_examples.html">dipr_example</a></span><span class="op">(</span><span class="st">"starwars-fwf.dat.gz"</span><span class="op">)</span></code></pre></div>
<p>The main function in the package is <code><a href="reference/read_dat.html">read_dat()</a></code> which allows you to directly read `.dat.gz files:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_dat.html">read_dat</a></span><span class="op">(</span>data_path <span class="op">=</span> <span class="va">dat_path</span>,
                data_dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span>
<span class="co">#&gt; v Reading starwars-fwf</span>
<span class="co">#&gt; Rows: 15 Columns: 5</span>
<span class="co">#&gt; -- Column specification --------------------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; chr (2): name, species</span>
<span class="co">#&gt; dbl (2): height, mass</span>
<span class="co">#&gt; lgl (1): has_hair</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   name           height  mass has_hair species</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;chr&gt;  </span>
<span class="co">#&gt; 1 Luke Skywalker    172    77 FALSE    Human  </span>
<span class="co">#&gt; 2 C-3PO             167    75 TRUE     Droid  </span>
<span class="co">#&gt; 3 R2-D2              96    32 TRUE     Droid  </span>
<span class="co">#&gt; 4 Darth Vader       202   136 FALSE    Human  </span>
<span class="co">#&gt; 5 Leia Organa       150    49 FALSE    Human  </span>
<span class="co">#&gt; 6 Owen Lars         178   120 FALSE    Human</span></code></pre></div>
<p>If two files share a common data dictionary you can supply a vector of filenames to the <code>data_path</code> argument and <code>read_dat</code> will combine them for you into one dataframe:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dipr_examples.html">dipr_example</a></span><span class="op">(</span><span class="st">"starwars-fwf2.dat.gz"</span><span class="op">)</span>
<span class="va">raw_two_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_dat.html">read_dat</a></span><span class="op">(</span>
    data_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dat_path</span>, <span class="va">dat_path2</span><span class="op">)</span>,
    data_dict <span class="op">=</span> <span class="va">dict</span>,
    id <span class="op">=</span> <span class="st">"file"</span>
  <span class="op">)</span>
<span class="co">#&gt; v Reading starwars-fwf and starwars-fwf2</span>
<span class="co">#&gt; Rows: 30 Columns: 6</span>
<span class="co">#&gt; -- Column specification --------------------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; chr (2): name, species</span>
<span class="co">#&gt; dbl (2): height, mass</span>
<span class="co">#&gt; lgl (1): has_hair</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<p>Working with the data.table package for data manipulation is also possible in dipr using the <code>read_dat_dt</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_dat.html">read_dat_dt</a></span><span class="op">(</span>
    data_path <span class="op">=</span> <span class="va">dat_path</span>,
    data_dict <span class="op">=</span> <span class="va">dict</span>
  <span class="op">)</span>
<span class="co">#&gt; v Reading starwars-fwf</span>
<span class="co">#&gt; Rows: 15 Columns: 5</span>
<span class="co">#&gt; -- Column specification --------------------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; chr (2): name, species</span>
<span class="co">#&gt; dbl (2): height, mass</span>
<span class="co">#&gt; lgl (1): has_hair</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<div id="data-dictionary" class="section level3">
<h3 class="hasAnchor">
<a href="#data-dictionary" class="anchor"></a>Data Dictionary</h3>
<p>Data Dictionaries need to be in a data frame format that includes ‘name`, ’start’, ‘stop’, and ‘length’ columns (in any order):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">&gt;</span><span class="st"> </span>dict</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># A tibble: 64 x 4</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>   start  stop length name                      </span>
<span id="cb9-4"><a href="#cb9-4"></a>   <span class="op">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span></span></code></pre></div>
</div>
</div>
<div id="project-status" class="section level2">
<h2 class="hasAnchor">
<a href="#project-status" class="anchor"></a>Project Status</h2>
<p>Under development</p>
</div>
<div id="license" class="section level2">
<h2 class="hasAnchor">
<a href="#license" class="anchor"></a>License</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>Copyright <span class="dv">2019</span> Province of British Columbia</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>Licensed under the Apache License, Version <span class="fl">2.0</span> (the <span class="st">"License"</span>);</span>
<span id="cb10-4"><a href="#cb10-4"></a>you may not use this file except <span class="cf">in</span> compliance with the License.</span>
<span id="cb10-5"><a href="#cb10-5"></a>You may obtain a copy of the License at </span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>   http<span class="op">:</span><span class="er">//</span>www.apache.org<span class="op">/</span>licenses<span class="op">/</span>LICENSE<span class="fl">-2.0</span></span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>Unless required by applicable law or agreed to <span class="cf">in</span> writing, software</span>
<span id="cb10-10"><a href="#cb10-10"></a>distributed under the License is distributed on an <span class="st">"AS IS"</span> BASIS,</span>
<span id="cb10-11"><a href="#cb10-11"></a>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span id="cb10-12"><a href="#cb10-12"></a>See the License <span class="cf">for</span> the specific language governing permissions and</span>
<span id="cb10-13"><a href="#cb10-13"></a>limitations under the License.</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/bcgov/dipr/">https://​github.com/​bcgov/​dipr/​</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>Apache License (== 2.0) | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Sam Albers <br><small class="roles"> Author, maintainer </small>  </li>
<li>Steph Hazlitt <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Sam Albers, Steph Hazlitt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
